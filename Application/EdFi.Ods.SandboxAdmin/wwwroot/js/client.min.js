function ClientsViewModel(){var n=this,t={create:function(n){return new ClientViewModel(n.data)}};n.apiClients=ko.mapping.fromJS([],t);n.error=ko.observable();n.confirmationDialog=new ConfirmationDialog;n.addApplicationDialog=new AddApplicationDialog;n.tokenDialog=new TokenDialog;n.shouldShowTable=ko.computed(function(){return n.apiClients().length>0});n.canAddMoreApplications=ko.observable(!0);n.clientStatus=ko.computed(function(){switch(n.apiClients().length){case 0:return"You have no sandboxes";case 1:return"You have 1 sandbox";default:return"You have "+n.apiClients().length+" sandboxes"}});n.getData=function(){$.ajax({type:"GET",url:EdFiAdmin.Urls.client,dataType:"json",success:function(t){if(ko.mapping.fromJS(t,n.apiClients),!IsFullyLoaded(t))with(n)setTimeout(function(){getData()},3e3)},error:function(t,i,r){return n.error(r),0},statusCode:{302:function(){console.log("302")}}})};n.doAddClient=function(t){n.error("");var i=n.addApplicationDialog.applicationName(),r=n.addApplicationDialog.useSampleData()?"sample":"minimal";$.ajax({type:"POST",data:{Name:i,SandboxType:r,IsDedicated:!0},url:EdFiAdmin.Urls.client,dataType:"json",success:function(i){t();var r=new ClientViewModel(i);if(n.apiClients.push(r),r.IsLoading)with(n)setTimeout(function(){getData()},3e3)},error:function(i,r){t();switch(i.status){case 400:n.error("Maximum number of sandboxes reached. Please reuse or delete an existing sandbox.");break;case 406:n.error("You must provide a name for your client application sandbox.");break;default:n.error(r)}return 0}})};n.updateClientClicked=function(t){var i=function(i){var r=ko.mapping.toJS(t);$.ajax({type:"PUT",data:r,url:EdFiAdmin.Urls.client+"/"+t.Id(),dataType:"json",success:function(r){var u=new ClientViewModel(r);n.apiClients.replace(t,u);i()},error:function(t,r,u){return n.error(u),i(),0}})};n.error("");n.confirmationDialog.show({message:"This operation will permanently change the client secret for this sandbox.  Any existing client applications should also be modified to use the new secret.<br/><br/>This operation cannot be undone.",buttonText:"Change Secret",callback:i})};n.tokenClientClicked=function(t){var i=ko.mapping.toJS(t),u={Client_id:i.Key.toString(),Response_type:"code"},r;$.support.cors=!0;r={Client_id:i.Key,Client_secret:i.Secret,Grant_type:"client_credentials"};$.post(EdFiAdmin.Urls.oauth+"token",r,function(t){n.tokenDialog.show({message:t.Access_token||t.access_token,buttonText:"OK",callback:null})},"json").error(function(){alert("Unable to retrieve an access token. Please verify that your application secret is correct.")})};n.deleteClientClicked=function(t){var i=function(i){var r=ko.mapping.toJS(t);$.ajax({type:"DELETE",data:r,url:EdFiAdmin.Urls.client+"/"+t.Key(),dataType:"json",success:function(){n.apiClients.remove(t);i()},error:function(t,r,u){return n.error(u),i(),0}})};n.error("");n.confirmationDialog.show({message:"This operation will permanently delete this sandbox, and all uploaded data will be lost.  <br/><br/>This operation cannot be undone.",buttonText:"Delete",callback:i})};n.addApplicationClicked=function(){n.addApplicationDialog.show({callback:n.doAddClient})};n.getData()}var Sandbox=function(n,t){this.sandboxType=n;this.dedicated=t;this.value=function(){switch(this.sandboxType){case"minimal":return 1;case"sample":return 2;default:return 0}}},ModalController=function(n){var t=this;this.callback=null;this.confirmChecked=ko.observable(!1);var i=function(){return $("#"+n.htmlId)},r=function(){return $("#"+n.htmlId+" .wait-spinner")},u=function(){r().removeClass("hidden")},f=function(){r().addClass("hidden")};this.show=function(n){t.callback=n;t.confirmChecked(!1);f();i().modal("show")};this.hide=function(){i().modal("hide")};this.onOkClicked=function(){n.closeOnOk?(t.hide(),t.callback()):(u(),t.callback(t.hide))};i().modal({show:!1,backdrop:"static",keyboard:!1})},ConfirmationDialog=function(){var t=this,n;this.htmlId="modal-confirm";n=new ModalController({htmlId:t.htmlId});this.message=ko.observable("");this.buttonText=ko.observable("");this.disableOkButton=ko.computed(function(){return!n.confirmChecked()});this.onOkClicked=n.onOkClicked;this.confirmChecked=n.confirmChecked;this.show=function(i){t.message(i.message);t.buttonText(i.buttonText);n.show(i.callback)}},TokenDialog=function(){var n=this,t;this.htmlId="modal-token";t=new ModalController({htmlId:n.htmlId});this.message=ko.observable("");this.show=function(i){n.message(i.message);t.show(i.callback)}},AddApplicationDialog=function(){var n=this,t;n.applicationName=ko.observable("");n.useSampleData=ko.observable(!1);n.canAdd=ko.computed(function(){return n.applicationName().length>0});n.htmlId="modal-add";t=new ModalController({htmlId:n.htmlId});this.onOkClicked=t.onOkClicked;this.show=function(i){n.applicationName("");n.useSampleData(!1);t.show(i.callback)}},ClientViewModel=function(n){var t=this;ko.mapping.fromJS(n,{},this);this.HasSampleData=ko.computed(function(){return t.SandboxTypeName()=="Sample"?"Yes":"No"})},IsFullyLoaded=function(n){var t=!0;return $.each(n,function(n,i){i.IsLoading&&(t=!1)}),t},boundModel;$(function(){$.ajaxSetup({contentType:"application/json",processData:!1});$.ajaxPrefilter(function(n){n.data&&(n.data=JSON.stringify(n.data))});var n=new ClientsViewModel;boundModel=n;ko.applyBindings(n)});